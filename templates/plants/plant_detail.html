{% extends "base.html" %}

{% block title %}Detalhes de {{ plant.nome }}{% endblock %}

{% block content %}
<!-- ... (cabeçalho da página inalterado) ... -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ plant.nome }} <small class="text-muted">({{ plant.identificacao }})</small></h1>
    <div>
        <a href="{% url 'plants:list' %}" class="btn btn-outline-secondary">Voltar</a>
        <a href="{% url 'plants:update' plant.pk %}" class="btn btn-outline-primary">Editar</a>
        <a href="{% url 'plants:delete' plant.pk %}" class="btn btn-outline-danger">Excluir</a>
    </div>
</div>


<div class="row">
    <!-- Coluna Principal (Esquerda) -->
    <div class="col-md-8">
        <!-- Histórico de Crescimento -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Histórico de Crescimento</span>
                <!-- BOTÃO PARA ADICIONAR NOVO EVENTO -->
                <a href="{% url 'growth_history:create' plant_pk=plant.pk %}" class="btn btn-sm btn-success">
                    + Adicionar Evento
                </a>
            </div>
            <div class="card-body">
                {% if not plant.historico.all %}
                    <p class="text-center text-muted mt-3">Nenhum evento registrado no histórico. Clique em "+ Adicionar Evento" para começar.</p>
                {% else %}
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Evento</th>
                                <th>Observações</th>
                                <th>Foto</th>
                                <th></th> <!-- Coluna para ações -->
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in plant.historico.all %}
                            <tr>
                                <td class="align-middle">{{ entry.data_hora_evento|date:"d/m/Y H:i" }}</td>
                                <td class="align-middle">{{ entry.tipo_evento }}</td>
                                <td class="align-middle text-pre-wrap">{{ entry.observacoes }}</td>
                                <td class="align-middle">
                                    {% if entry.foto %}
                                        <a href="{{ entry.foto.url }}" target="_blank">
                                            <img src="{{ entry.foto.url }}" alt="Foto do evento" style="max-height: 50px; max-width: 50px; object-fit: cover;">
                                        </a>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td class="align-middle text-end">
                                    <!-- BOTÃO PARA DELETAR O EVENTO -->
                                    <a href="{% url 'growth_history:delete' plant_pk=plant.pk pk=entry.pk %}" class="btn btn-sm btn-outline-danger" title="Excluir evento">
                                        ×
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
        </div>
        <!-- ... (card de regas inalterado) ... -->
    </div>

    <!-- Coluna Lateral (Direita) -->
    <!-- ... (código da coluna lateral inalterado) ... -->
</div>
{% endblock %}